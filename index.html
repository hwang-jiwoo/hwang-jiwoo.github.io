<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>HWANG JIWOO | Personal website</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="title" content="Hwang Jiwoo | Personal Website" />
  <meta name="keywords" content="KNU,kangwon,research,phd,hci,hwang jiwoo,jiwoo hwang" />
  <meta name="author" content="Hwang Jiwoo" />
  <meta name="description" content="A personal website for Hwang Jiwoo" />
  <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
  <!-- ===== NAV ===== -->
  <nav class="navbar" role="navigation" aria-label="Primary">
    <div class="nav-inner">
      <div class="nav-toprow">
        <a class="brand" href="#about">Hwang Jiwoo</a>
        <button class="hamburger" id="hamburger" aria-label="Toggle menu" aria-expanded="false">
          <span class="bar"></span><span class="bar"></span><span class="bar"></span>
        </button>
      </div>

      <!-- 모바일: 드롭다운 / 데스크톱: 오른쪽 가로 메뉴 -->
      <div class="nav-menu" id="navMenu">
        <ul class="nav-list">
          <li><a class="nav-link" href="#about">About</a></li>
          <li><a class="nav-link" href="#publications">Publications</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- ===== ABOUT ===== -->
  <main class="container page active" id="menu_home">
    <section class="card">
      <h1 id="about">ABOUT</h1>
      <p>
        I am a Ph.D. student in the Graduate School of Data Science at Kangwon National University.
        I received my B.S. and M.S. degrees in Computer Science and Engineering from Kangwon National University.
        My research interests include various aspects of Human-Computer Interaction (HCI).
      </p>
      <div class="chips">
        <a href="https://scholar.google.co.kr/citations?hl=en&user=g8tiXdMAAAAJ" target="_blank" rel="noopener">Google Scholar</a>
      </div>
      <div class="updated">Updated 13 Aug, 2025</div>
    </section>
  </main>

  <!-- ===== PUBLICATIONS ===== -->
  <section class="container page" id="menu_publications">
    <div class="card">
      <h1 id="publications">Publications</h1>
      <p>
        Equally contributed *, Corresponding Author +
      </p>
      <div class="filters" aria-label="Publications filters">
        <input id="yearStart" class="year-input" type="number" inputmode="numeric" placeholder="Start" min="1900" max="2100" />
        <span class="dash">–</span>
        <input id="yearEnd" class="year-input" type="number" inputmode="numeric" placeholder="End" min="1900" max="2100" />
        <div class="tabs" role="tablist" aria-label="Type filter">
          <button class="tab" data-type="All" aria-pressed="true">All</button>
          <button class="tab" data-type="Journal" aria-pressed="false">Journal</button>
          <button class="tab" data-type="Conference" aria-pressed="false">Conference</button>
          <button class="tab" data-type="Poster" aria-pressed="false">Poster</button>
        </div>
      </div>
      <div id="pubGroups"></div>
    </div>
  </section>

  <script>
    /* ===== Config: repo paths ===== */
    const PUB_DIR = 'assets/publications/';       // CSV & PDF directory
    const CSV_FILE = 'publications.csv';          // assets/publications/publications.csv

    /* ===== SPA Router ===== */
    const PAGES = { about:'menu_home', publications:'menu_publications' };
    function showPageByHash(){
      const hash = (location.hash || '#about').replace('#','');
      const target = PAGES[hash] || PAGES.about;
      document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
      document.getElementById(target).classList.add('active');
      document.querySelectorAll('.nav-link').forEach(a=>{
        const h = a.getAttribute('href').replace('#','');
        a.classList.toggle('active', h===hash);
      });
      closeMenu();
    }
    window.addEventListener('hashchange', showPageByHash);

    /* ===== Mobile Nav ===== */
    const hamburger = document.getElementById('hamburger');
    const navMenu = document.getElementById('navMenu');
    function closeMenu(){ hamburger.setAttribute('aria-expanded','false'); navMenu.classList.remove('open'); }
    function toggleMenu(){
      const open = hamburger.getAttribute('aria-expanded') === 'true';
      hamburger.setAttribute('aria-expanded', String(!open));
      navMenu.classList.toggle('open', !open);
    }
    hamburger.addEventListener('click', toggleMenu);
    document.addEventListener('click', (e)=>{
      if (!navMenu.contains(e.target) && !hamburger.contains(e.target)) closeMenu();
    });

    /* ===== CSV/TSV Parser ===== */
    function detectDelimiter(text){
      const first = text.split(/\r?\n/).find(l=>l.trim().length>0) || '';
      const c = (first.match(/,/g)||[]).length, t=(first.match(/\t/g)||[]).length;
      return t>c ? '\t' : ',';
    }
    function parseDelimited(text, d){
      const rows=[]; let i=0, f='', r=[], q=false;
      while(i<text.length){
        const ch=text[i];
        if(ch === '"'){ if(q && text[i+1] === '"'){ f+='"'; i+=2; continue; } q=!q; i++; continue; }
        if(!q && ch===d){ r.push(f); f=''; i++; continue; }
        if(!q && ch==='\n'){ r.push(f); rows.push(r); r=[]; f=''; i++; continue; }
        if(!q && ch==='\r'){ i++; continue; }
        f+=ch; i++;
      }
      if(f.length || r.length){ r.push(f); rows.push(r); }
      return rows.filter(row=>row.some(c=>(c||'').trim().length));
    }
    function parseTable(text){
      const delim = detectDelimiter(text);
      const rows = parseDelimited(text, delim);
      if(!rows.length) return {headers:[], data:[]};
      const headers = rows[0].map(h=>(h||'').trim());
      const data = rows.slice(1).map(r=>{
        const o={}; headers.forEach((h,idx)=>o[h]=(r[idx]??'').trim()); return o;
      });
      return {headers, data};
    }

    /* ===== Publications ===== */
    const PUB = { raw:[], filtered:[], type:'All', years:{min:null,max:null} };

    // 제목을 파일명으로 → ':'는 '-'로 치환 후 URL 인코딩
    function filenameFromTitle(title){
      const safe = String(title).replace(/:/g,'-'); // 맥 파일시스템 대응
      return encodeURIComponent(safe) + '.pdf';
    }
    function urlFromTitle(title){
      return PUB_DIR + filenameFromTitle(title);
    }

    // HEAD로 파일 존재 확인 (캐시)
    const PDF_CACHE = new Map(); // title -> Promise<url|null>
    async function getPDFUrlIfExists(title){
      if(PDF_CACHE.has(title)) return PDF_CACHE.get(title);
      const url = urlFromTitle(title);
      const p = (async ()=>{
        try{
          const res = await fetch(url, { method:'HEAD', cache:'no-store' });
          if (res.ok) return url;
          return null;
        }catch(_e){ return null; }
      })();
      PDF_CACHE.set(title, p);
      return p;
    }

    function escapeHTML(s){ return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
    function normalizeRows(rows){
      return rows.map(r=>({
        Types:r.Types,
        Years:(r.Years||'').replace(/[^\d]/g,''),
        Title:r.Title,
        Information:r.Information,
        Authors:r.Authors
      })).filter(r=>r.Title && r.Years);
    }
    function computeYearRange(list){
      const ys=list.map(r=>parseInt(r.Years,10)).filter(n=>!isNaN(n));
      return ys.length?{min:Math.min(...ys),max:Math.max(...ys)}:{min:null,max:null};
    }

    async function renderGroups(){
      const wrap=document.getElementById('pubGroups'); wrap.innerHTML='';
      const groups={};
      for(const it of PUB.filtered){ (groups[it.Years] = groups[it.Years] || []).push(it); }
      const years=Object.keys(groups).sort((a,b)=>parseInt(b)-parseInt(a));

      // 현재 화면에 필요한 타이틀의 PDF 존재여부 확인
      const titles = [...new Set(PUB.filtered.map(x=>x.Title))];
      const existMap = new Map();
      await Promise.all(titles.map(async t=>{
        existMap.set(t, await getPDFUrlIfExists(t)); // url 또는 null
      }));

      for(const y of years){
        const h=document.createElement('div'); h.className='year'; h.textContent=y;
        const ul=document.createElement('ul'); ul.className='publist';
        for(const it of groups[y]){
          const li=document.createElement('li'); li.className='pubitem';
          const pdfUrl = existMap.get(it.Title); // null이면 링크 없이 표시
          const titleHTML = pdfUrl
            ? `<a href="${escapeHTML(pdfUrl)}" target="_blank" rel="noopener">${escapeHTML(it.Title)}</a>`
            : escapeHTML(it.Title);
          li.innerHTML = `
            <div class="title">${titleHTML}</div>
            <div class="venue">${escapeHTML(it.Information)}</div>
            <div class="authors">${escapeHTML(it.Authors)}</div>
          `;
          ul.appendChild(li);
        }
        wrap.appendChild(h); wrap.appendChild(ul);
      }
    }

    async function applyFilters(){
      const s=parseInt(document.getElementById('yearStart').value,10);
      const e=parseInt(document.getElementById('yearEnd').value,10);
      const type=PUB.type;
      PUB.filtered = PUB.raw.filter(it=>{
        const y=parseInt(it.Years,10);
        if(!isNaN(s) && y<s) return false;
        if(!isNaN(e) && y>e) return false;
        if(type!=='All' && it.Types!==type) return false;
        return true;
      });
      await renderGroups();
    }

    function bindPublicationUI(){
      const tabs=document.querySelectorAll('.tab');
      tabs.forEach(btn=>{
        btn.addEventListener('click', async ()=>{
          tabs.forEach(b=>b.setAttribute('aria-pressed','false'));
          btn.setAttribute('aria-pressed','true');
          PUB.type = btn.dataset.type;
          await applyFilters();
        });
      });
      ['yearStart','yearEnd'].forEach(id=>{
        const el=document.getElementById(id);
        el.addEventListener('change', applyFilters);
        el.addEventListener('keydown', e=>{ if(e.key==='Enter') applyFilters(); });
      });
    }

    async function initPublications(){
      try{
        const res = await fetch(PUB_DIR + CSV_FILE, {cache:'no-store'});
        if(!res.ok) return;
        const text = await res.text();
        const {headers,data} = parseTable(text);
        const needed=['Types','Years','Title','Information','Authors'];
        if(!needed.every(h=>headers.includes(h))) return;
        PUB.raw = normalizeRows(data);
        PUB.filtered=[...PUB.raw];
        PUB.years = computeYearRange(PUB.raw);
        if(PUB.years.min) document.getElementById('yearStart').placeholder = PUB.years.min;
        if(PUB.years.max) document.getElementById('yearEnd').placeholder = PUB.years.max;
        await renderGroups();
      }catch(_e){/* silent */}
    }

    // init
    window.addEventListener('DOMContentLoaded', async ()=>{
      showPageByHash();
      bindPublicationUI();
      await initPublications();
    });
  </script>
</body>
</html>
